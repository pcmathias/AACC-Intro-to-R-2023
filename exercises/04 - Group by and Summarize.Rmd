---
title: "Statistical Analysis in R"
output: html_notebook
editor_options: 
  chunk_output_type: inline
---

## Setup

```{r setup}
## remove all user defined objects in your workspace
rm(list=ls())

library(tidyverse)  # Provides functions used throughout this session

biochem <- read_csv("biochem_wide.csv")

```

## Summarize

### What is the distribution of Alkaline Phosphatase results?

```{r}
ggplot(data = biochem) +
  geom_histogram(aes(x = alkaline_phosphatase), binwidth = 1)
```

### Summarize the total number of of alkaline phosphatase results.

```{r}
biochem %>%
  select(mrn, alkaline_phosphatase) %>%
	summarize(test_count = n(),
	          mean_alp = mean(alkaline_phosphatase))

```

## Your Turn 1

Fill in gaps in code below to:

a)  Calculate the median alkaline phosphatase ("alkaline_phosphatase") concentration and average calcium ("total_calcium") concentration.

```{r}
stats_1a <- biochem %>%
	summarize(test_count = n(),
	          mean_alp = median(_________________),
	          mean_ca = mean(_____________))
stats_1a
```

b)  Calculate the interquartile range for alkaline phosphatase and the standard deviation for calcium. The function for interquartile range is "IQR" and for standard deviation is "sd"

```{r}
stats_1b <- biochem %>%
	summarize(test_count = n(),
	          median_alp = median(alkaline_phosphatase),
	          mean_ca = mean(total_calcium),
	          iqr_alp = ___(________________),
	          sd_ca = __(_____________)_
stats_1b
```
## Other examples of summarize
```{r}
stats_1c <- biochem %>%
  summarize(test_count = n(),
	          lower95_alp = quantile(alkaline_phosphatase, 0.025),
            upper95_alp = quantile(alkaline_phosphatase, 0.975),
	          var_alp = var(alkaline_phosphatase),
	          cv_alp = 100*sd(alkaline_phosphatase)/mean(alkaline_phosphatase))

stats_1c
```


Consider: How would you calculate the total number of tests performed by patient gender?

## group_by

```{r}
biochem %>%
  select(mrn, gender, pat_type) %>%
  group_by(gender, pat_type)
```

## group_by %\>% summarize

```{r}
gend_cnt <- biochem %>%  
	select(mrn, gender, alkaline_phosphatase) %>%
  group_by(gender) %>%
  summarize(test_count = n())
gend_cnt
```

## Your Turn 2

a)  Calculate the median alkaline phosphatase concentration for Men and Women

```{r, eval=FALSE}
biochem %>%
  ________(______) %>%
  summarize(median_alp = median(alkaline_phosphatase))
```

b)  Calculate the median alkaline phosphatase concentration in Men and Women over 51

```{r, eval=FALSE}
biochem %>%
  ________(______) %>%
  ______(___ > __) %>%
  summarize(median_alp = _(alkaline_phosphatase)_
```


## Joining Multiple Dataframes Together
I want to add the total number of Males and Females to each row of the biochemistry dataset.

```{r}
left_example <- left_join(biochem, gend_cnt, by="gender")
left_example

right_example <- right_join(biochem, gend_cnt, by="gender")
right_example

inner_example <- inner_join(biochem, gend_cnt, by="gender")
inner_example

full_example <- full_join(biochem, gend_cnt, by="gender")
full_example
```


## Your turn
Use the approriate join command to combine the stats_1b dataframe and stats_1c dataframe using the test_count column.

```{r}
all_stats <- _________(stats_1b, stats_1c, __ = "________")
all_stats

```
## What else

###Basic Statistical Tests
```{r}
#filter males over 51
biochem_male <- biochem %>%
  filter(gender == "Male" & age >51)

#filter females over 51
biochem_female <- biochem %>%
  filter(gender == "Female" & age > 51)

#create variables for alkaline phosphatase
alp_male <- biochem_male$alkaline_phosphatase
alp_female <- biochem_female$alkaline_phosphatase

#perform unpaired wilkoxon rank sum test
wilcox.test(alp_male, alp_female, paired=FALSE)
```

### Linear Regression

```{r}
#creates linear regression model
lm.model <- lm(blood_urea_nitrogen ~ creatinine + aspartate_aminotransferase, biochem)
summary(lm.model)

#scatterplot of creatinine vs. BUN
ggplot(biochem, aes(creatinine, blood_urea_nitrogen)) +
  geom_point() +
  xlim(0,3) + 
  ylim(0,50)+
  geom_smooth(method="lm", se=FALSE, color="red", formula = y ~ x)

#scatterplot of AST vs. BUN
ggplot(biochem, aes(aspartate_aminotransferase, blood_urea_nitrogen)) +
  geom_point() +
  xlim(0,300) + 
  ylim(0,50)+
  geom_smooth(method="lm", se=FALSE, color="red", formula = y ~ x)

#report model coefficients
lm.model$coefficients

#report confidence of model coefficients
confint(lm.model)

```

## Your turn!
Perform a linear regression of Alkaline Phosphatase as a function of gender and age. What happens when you perform a linear regerssion with a categorical variable?

For this one you're all on your own!

```{r}
## create linear regression model

##summarize the model

## extract model coefficient

## extract confidence intervals

```
